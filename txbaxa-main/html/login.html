<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>BAXA â€“ Login</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <!-- Optional: Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background: linear-gradient(120deg, #f3ecff, #e5d1ff, #f39c12);
        background-size: 400% 400%;
        animation: gradientBackground 15s ease infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
      }
      @keyframes gradientBackground {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .login-container {
        background: #fff;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        width: 100%;
        max-width: 400px;
        text-align: center;
      }
      .login-container h1 {
        margin-bottom: 1rem;
      }
      .login-btn {
        margin-top: 1rem;
        width: 100%;
      }
      .error-message {
        color: #b71c1c;
        font-size: 0.9rem;
        margin-top: 0.5rem;
        display: none; /* Hidden by default */
      }
      .logo {
        width: 180px;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- If already logged in, skip login -->
    <script>
      if (localStorage.getItem("baxaIsLoggedIn") === "true") {
        window.location.href = "portal.html";
      }
    </script>
    <div class="login-container">
      <!-- Replace with your actual BAXA logo -->
      <img src="../assets/images/logo.png" alt="BAXA Logo" class="logo" />

      <h1 class="title is-4">Member Login</h1>

      <!-- Simple Email/Password Form -->
      <div class="field">
        <label class="label">Email</label>
        <div class="control">
          <input
            id="emailInput"
            class="input"
            type="email"
            placeholder="Enter your email"
            required
          />
        </div>
      </div>
      <div class="field">
        <label class="label">Password</label>
        <div class="control">
          <input
            id="passwordInput"
            class="input"
            type="password"
            placeholder="Enter your password"
            required
          />
        </div>
      </div>
      <p id="errorMessage" class="error-message">Invalid credentials!</p>

      <button id="loginBtn" class="button is-primary login-btn">Login</button>
    </div>

    <script>
      let members = [];
      const loginBtn = document.getElementById("loginBtn");
      const emailInput = document.getElementById("emailInput");
      const passwordInput = document.getElementById("passwordInput");
      const errorMessage = document.getElementById("errorMessage");

      // Disable the login button until member data is loaded
      loginBtn.disabled = true;
      loginBtn.textContent = "Loading members...";

      // Replace the URL below with your actual published Google Sheets CSV URL
      fetch(
        "https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/pub?output=csv"
      )
        .then((response) => response.text())
        .then((csvText) => {
          // Split CSV text into rows and filter out empty lines
          const rows = csvText.split("\n").filter((row) => row.trim() !== "");
          // Remove header row if present (assumes first row contains 'email')
          if (rows[0].toLowerCase().includes("email")) {
            rows.shift();
          }
          // Map CSV rows to member objects
          members = rows.map((row) => {
            const [email, password] = row.split(",");
            return { email: email.trim(), password: password.trim() };
          });

          // Add temporary developer login
          members.push({
            email: "temp@baxa.com",
            password: "tempPass123",
          });

          loginBtn.disabled = false;
          loginBtn.textContent = "Login";
        })
        .catch((error) => {
          console.error("Error fetching members data:", error);
          loginBtn.disabled = false;
          loginBtn.textContent = "Login";
        });

      loginBtn.addEventListener("click", () => {
        const enteredEmail = emailInput.value.trim();
        const enteredPassword = passwordInput.value;

        if (members.length === 0) {
          errorMessage.textContent =
            "Members data not loaded yet. Please try again in a moment.";
          errorMessage.style.display = "block";
          return;
        }

        // Check against the members array
        const validMember = members.find(
          (member) =>
            member.email === enteredEmail && member.password === enteredPassword
        );

        if (validMember) {
          // Mark user as "logged in"
          localStorage.setItem("baxaIsLoggedIn", "true");
          localStorage.setItem("memberEmail", validMember.email);
          // Redirect to the portal page
          window.location.href = "portal.html";
        } else {
          // Show error message
          errorMessage.style.display = "block";
        }
      });
    </script>
  </body>
</html>
